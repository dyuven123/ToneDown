#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ ToneDown
# –ó–∞–ø—É—Å–∫–∞—Ç—å –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ ToneDown"
echo "=========================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–∞—Ä–¥–∫–æ–¥–∞ —Ä—É—Å—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ UI
echo ""
echo "üì± –ü–æ–∏—Å–∫ —Ö–∞—Ä–¥–∫–æ–¥–∞ —Ä—É—Å—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ UI:"
echo "----------------------------------------"
if grep -r 'Text("[^"]*[–∞-—è—ë][^"]*")' ToneDown/Features/ --include="*.swift" 2>/dev/null; then
    echo "‚ùå –ù–∞–π–¥–µ–Ω—ã —Ö–∞—Ä–¥–∫–æ–¥ —Ä—É—Å—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ UI!"
else
    echo "‚úÖ –•–∞—Ä–¥–∫–æ–¥ —Ä—É—Å—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ UI –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–∞—Ä–¥–∫–æ–¥–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ UI
echo ""
echo "üåç –ü–æ–∏—Å–∫ —Ö–∞—Ä–¥–∫–æ–¥–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ UI:"
echo "------------------------------------------"
if grep -r 'Text("[^"]*[A-Za-z][^"]*")' ToneDown/Features/ --include="*.swift" 2>/dev/null | grep -v "LocalizedStringKey"; then
    echo "‚ùå –ù–∞–π–¥–µ–Ω—ã —Ö–∞—Ä–¥–∫–æ–¥ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ UI!"
else
    echo "‚úÖ –•–∞—Ä–¥–∫–æ–¥ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ UI –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
echo ""
echo "üî§ –ü–æ–∏—Å–∫ –Ω–µ–ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫:"
echo "----------------------------------"
if grep -r 'Text("[^"]*")' ToneDown/Features/ --include="*.swift" 2>/dev/null | grep -v "LocalizedStringKey" | grep -v "systemName"; then
    echo "‚ùå –ù–∞–π–¥–µ–Ω—ã –Ω–µ–ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏!"
else
    echo "‚úÖ –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–ª—é—á–µ–π
echo ""
echo "üîë –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏:"
echo "----------------------------------------------"

# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–ª—é—á–∏ –∏–∑ —Ä—É—Å—Å–∫–æ–≥–æ —Ñ–∞–π–ª–∞
ru_keys=$(grep '^"[^"]*" = ' ToneDown/ru.lproj/Localizable.strings | sed 's/^"\([^"]*\)".*/\1/' | sort)

# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–ª—é—á–∏ –∏–∑ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —Ñ–∞–π–ª–∞
en_keys=$(grep '^"[^"]*" = ' ToneDown/en.lproj/Localizable.strings | sed 's/^"\([^"]*\)".*/\1/' | sort)

# –ù–∞—Ö–æ–¥–∏–º –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Ä—É—Å—Å–∫–æ–º —Ñ–∞–π–ª–µ
missing_in_en=$(comm -23 <(echo "$ru_keys") <(echo "$en_keys"))

# –ù–∞—Ö–æ–¥–∏–º –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —Ñ–∞–π–ª–µ
missing_in_ru=$(comm -13 <(echo "$ru_keys") <(echo "$en_keys"))

if [ -n "$missing_in_en" ]; then
    echo "‚ùå –ö–ª—é—á–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —Ñ–∞–π–ª–µ:"
    echo "$missing_in_en"
else
    echo "‚úÖ –í—Å–µ —Ä—É—Å—Å–∫–∏–µ –∫–ª—é—á–∏ –µ—Å—Ç—å –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —Ñ–∞–π–ª–µ"
fi

if [ -n "$missing_in_ru" ]; then
    echo "‚ùå –ö–ª—é—á–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ —Ä—É—Å—Å–∫–æ–º —Ñ–∞–π–ª–µ:"
    echo "$missing_in_ru"
else
    echo "‚úÖ –í—Å–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –∫–ª—é—á–∏ –µ—Å—Ç—å –≤ —Ä—É—Å—Å–∫–æ–º —Ñ–∞–π–ª–µ"
fi

# –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª—é—á–µ–π
ru_count=$(echo "$ru_keys" | wc -l)
en_count=$(echo "$en_keys" | wc -l)

echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
echo "---------------"
echo "–ö–ª—é—á–µ–π –≤ —Ä—É—Å—Å–∫–æ–º —Ñ–∞–π–ª–µ: $ru_count"
echo "–ö–ª—é—á–µ–π –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —Ñ–∞–π–ª–µ: $en_count"

if [ "$ru_count" -eq "$en_count" ]; then
    echo "‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π —Å–æ–≤–ø–∞–¥–∞–µ—Ç"
else
    echo "‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç"
fi

echo ""
echo "üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "-----------------"
echo "1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ LocalizedStringKey() –¥–ª—è UI —Å—Ç—Ä–æ–∫"
echo "2. –î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–ª—é—á–∏ –≤ –æ–±–∞ —Ñ–∞–π–ª–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏"
echo "3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–ª—é—á–µ–π (feature.section.element)"
echo "4. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º"
echo ""
echo "üìñ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞: LOCALIZATION_RULES.md"
